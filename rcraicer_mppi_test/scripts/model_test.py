import numpy as np
import torch
import torch.nn as nn
from dyn_model import DynModel

model1_path = "/home/lbarnett/ros2_ws/src/rcraicer/rcraicer_mppi_test/models/dynmodel_gazebo_states1.pth"
model2_path = "/home/lbarnett/ros2_ws/src/rcraicer/rcraicer_mppi_test/models/autorally_states.pth"

model1 = DynModel()
model1.load_state_dict(torch.load(model1_path))
model1.eval()


model2 = DynModel()
model2.load_state_dict(torch.load(model2_path))
model2.eval()

# ["roll","u_x","u_y","yaw_mder","steer","throttle"]
# data1 = [0.0, 0.0, 0.0, 0.0, 0.0, 0.8]
# data2 = [0.0, 0.0, 0.0, 0.0, 0.0, 0.8]

# data1 = [0.00197912,0.087988,0.0327559,0.00164792, -0.0948704,0.226337]
# data2 = [0.00197912,0.087988,0.0327559,0.00164792, -0.0948704,0.226337]

# data1 = [0.003726243507, 0.955393267237352, -2.76807786046967E-05, -0.0001139993547, 0.0, 1.0]
# data2 = [0.003726243507, 0.955393267237352, -2.76807786046967E-05, -0.0001139993547, 0.0, 1.0]

# State: 0,0,2.35,-0.000276667,-0.00339984,-3.68343e-05,-0.000554586,,0.00252477,0.0246776
# State: 4.83064e-05,-4.78603e-05,2.35001,-0.000577417,-0.00615421,-3.13744e-05,-0.00154054,,0.0360761,0.0766464

# data1 = [-0.000276667,-0.00339984,-3.68343e-05,-0.000554586, 0.00252477,1.0]
# data2 = [-0.000276667,-0.00339984,-3.68343e-05,-0.000554586, 0.00252477,1.0]


data1 = [0.0,0.,0.,0., 0.0, 0.0]
data2 = [0.0,0.,0.,0., 0.0, 0.0]

# data1 = [0.688282,	6.50133	,0.970481,	-0.886204, 0.449428,	0.65]
# data2 = [0.688282,	6.50133	,0.970481,	-0.886204, 0.449428,	0.65]

# data1 = [-2.83253518775723E-05, 0.394511691492657, -0.004991550310319, 0.020086751107955, 0.013358167372644, 1.0]
# data2 = [-2.83253518775723E-05, 0.394511691492657, -0.004991550310319, 0.020086751107955, 0.013358167372644, 1.0]

# data1 = [0.000209021, 0.00241826,-0.000659901,	-0.000816164, 0.0, 0.0]
# data2 = [0.000209021, 0.00241826,-0.000659901,	-0.000816164, 0.0, 0.0]

# data1 = [0.00168118,0.0715469,0.00435338,0.00377777, -0.376717,	-0.0760593]
# data2 = [0.00168118,0.0715469,0.00435338,0.00377777, -0.376717,	-0.0760593]


# data2 = [-0.000577417,-0.00615421,-3.13744e-05,-0.00154054, 0.0360761,0.0766464]


for i in range(0, 1):
    x1_data = torch.tensor(data1).to(dtype=torch.float32)            
    x2_data = torch.tensor(data2).to(dtype=torch.float32)            

    output1 = model1.forward(x1_data)
    output2 = model2.forward(x2_data)

    print("Step: " + str(i))
    print("Input")
    print(data1)
    print(data2)

    print("output")
    print(output1)
    print(output2)

    data1[0] = output1[0]
    data1[1] += output1[1] 
    data1[2] += output1[2] 
    data1[3] += output1[3] 

    data2[0] = output2[0]
    data2[1] += output2[1] 
    data2[2] += output2[2] 
    data2[3] += output2[3] 
    



# State: -0.0194728,-2.00383,2.9498,0.00190731,0.0835145,0.0313204,0.0015122,,-0.0946294,0.247181
# State: -0.0212319,-2.00413,2.94977,0.00197912,0.087988,0.0327559,0.00164792,,-0.0939639,0.240672
# State: -0.0230842,-2.00443,2.94974,0.00205622,0.0925116,0.0342008,0.0017865,,-0.0948704,0.226337